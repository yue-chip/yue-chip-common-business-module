import{i as Q,j as m,k as W,l as X,h as e,w as a,u as t,m as Z,n as ee,s as ae,o as z,p as f,c as P,b as R}from"./vue-router-ef9fc363.js";import{a as _,m as k,C as le,S as ne,P as te,B as oe,I as se,b as ue,c as re,d as de,_ as ie,F as pe}from"./axios-85071db1.js";import{q as me}from"./index-5f427048.js";import{M as S,L as fe,E as _e,_ as ce}from"./EditOutlined-007ce32e.js";import{D as M,_ as ve}from"./DeleteOutlined-ba572a4a.js";import{_ as ge}from"./index-c71dfe88.js";const Oe=Q({__name:"grid",setup(ye){const q=ee(),A=ae(),O=m();let x=m(!1),r=m({}),U=[],d=m(!1),s=m({}),c,N=m([]);const D=[{title:"网格名称",dataIndex:"name",fixed:"left",key:"name"},{title:"网格员",dataIndex:["user","name"],key:"username"},{title:"电话",dataIndex:["user","phoneNumber"],key:"username"},{title:"操作",key:"operation",fixed:"right",width:"160px"}];let b=m([]);W(()=>{c=A.query.organizationalId,v()});const E={onChange:(l,n)=>{U=l},getCheckboxProps:l=>({disabled:l.username==="admin"})};function v(){x.value=!0,r.value.organizationalId=c,_.axiosGet("/upms/console/grid/list/tree",{params:r.value},l=>{b.value=l.data,x.value=!1},null,null)}function F(){d.value=!0,O.value.validateFields().then(()=>{s.value.id?_.axiosPut("/upms/console/grid/update2",s.value,l=>{l.status===200&&(k.info(l.message),I())},null,null):(s.value.organizationalId=c,_.axiosPost("/upms/console/grid/add2",s.value,l=>{l.status===200&&(k.info(l.message),I())},null,null))}).catch(l=>{}).finally(()=>{})}function L(l){d.value=!0,s.value={name:l.name,parentId:l.parentId==0?void 0:l.parentId,userIds:l.user?l.user.map(n=>n.id):void 0,sort:l.sort,id:l.id,organizationalId:l.organizationalId},T(),console.log(l)}function h(l){if(!l||l.length===0){k.error("请选择要删除的数据！");return}S.confirm({title:"是否要删除该数据?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){const n={params:{ids:l},paramsSerializer:u=>me.stringify(u,{indices:!1})};_.axiosDelete("/upms/console/grid/delete",n,u=>{u.status===200&&(k.info(u.message),v())},null,null)},onCancel(){}})}function V(){d.value=!0,s.value={},T()}async function T(){await _.axiosGet("/upms/console/organizational/user/select/list",{params:{organizationalId:c}},l=>{N.value=l.data},null,null)}function I(){d.value=!1,s.value={},v()}function G(){q.go(-1)}return(l,n)=>{const u=oe,C=le,g=se,p=ue,i=re,y=de,$=ie,B=pe,K=ce,j=ge,H=ve,Y=S;return z(),X("div",null,[e(C,null,{default:a(()=>[e(u,{size:"small",onClick:n[0]||(n[0]=o=>G())},{icon:a(()=>[e(t(fe))]),default:a(()=>[f(" 返回 ")]),_:1})]),_:1}),e(C,null,{default:a(()=>[e(B,{ref:"from",model:t(r),"label-col":{span:4,offset:0}},{default:a(()=>[e(y,null,{default:a(()=>[e(i,{span:6},{default:a(()=>[e(p,{label:"网格名称",name:"name",ref:"name"},{default:a(()=>[e(g,{placeholder:"请输入网格名称",value:t(r).name,"onUpdate:value":n[1]||(n[1]=o=>t(r).name=o)},null,8,["value"])]),_:1},512)]),_:1}),e(i,{span:6},{default:a(()=>[e(p,{label:"姓名",name:"userName",ref:"userName"},{default:a(()=>[e(g,{placeholder:"请输入姓名",value:t(r).userName,"onUpdate:value":n[2]||(n[2]=o=>t(r).userName=o)},null,8,["value"])]),_:1},512)]),_:1}),e(i,{span:6}),e(i,{span:6})]),_:1}),e(y,{style:{height:"20px"}},{default:a(()=>[e(i,{span:24,style:{"text-align":"right"}},{default:a(()=>[e(p,null,{default:a(()=>[e($,{size:5},{default:a(()=>[e(u,{type:"primary",onClick:n[3]||(n[3]=o=>{t(r).pageNumber=1,v()})},{icon:a(()=>[e(t(ne))]),default:a(()=>[f(" 查询 ")]),_:1}),e(u,{type:"primary",onClick:n[4]||(n[4]=o=>V())},{icon:a(()=>[e(t(te))]),default:a(()=>[f(" 添加 ")]),_:1}),e(u,{type:"primary",danger:"",onClick:n[5]||(n[5]=o=>h(t(U)))},{icon:a(()=>[e(t(M))]),default:a(()=>[f(" 删除 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(C,null,{default:a(()=>[e(K,{rowKey:"id","row-selection":E,columns:D,"data-source":t(b),pagination:void 0,loading:t(x),scroll:{y:440}},{bodyCell:a(({column:o,text:ke,record:w})=>[o.key==="operation"?(z(),P($,{key:0,size:5},{default:a(()=>[e(u,{size:"small",onClick:J=>L(w)},{icon:a(()=>[e(t(_e))]),default:a(()=>[f(" 修改 ")]),_:2},1032,["onClick"]),w.username!=="admin"?(z(),P(u,{key:0,size:"small",type:"primary",danger:"",onClick:J=>h(w.id)},{icon:a(()=>[e(t(M))]),default:a(()=>[f(" 删除 ")]),_:2},1032,["onClick"])):R("",!0)]),_:2},1024)):R("",!0)]),_:1},8,["data-source","loading"])]),_:1}),e(Y,{width:"500px",visible:t(d),"onUpdate:visible":n[10]||(n[10]=o=>Z(d)?d.value=o:d=o),title:"添加/修改网格管理员",cancelText:"取消",okText:"保存",destroyOnClose:!0,mask:!0,maskClosable:!1,onCancel:I,onOk:F},{default:a(()=>[e(B,{ref_key:"fromAddOrUpdate",ref:O,rules:l.rules,model:t(s),labelCol:{span:5,offset:0}},{default:a(()=>[e(y,null,{default:a(()=>[e(i,{span:24},{default:a(()=>[e(p,{label:"上级网格",name:"userId",ref:"userId"},{default:a(()=>[e(j,{value:t(s).parentId,"onUpdate:value":n[6]||(n[6]=o=>t(s).parentId=o),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"选择上级网格","allow-clear":"","tree-default-expand-all":"","tree-data":t(b),"tree-node-filter-prop":"label","field-names":{children:"children",label:"name",value:"id"}},null,8,["value","tree-data"])]),_:1},512),e(p,{label:"名称",name:"name",ref:"name"},{default:a(()=>[e(g,{placeholder:"请输入网格名称",value:t(s).name,"onUpdate:value":n[7]||(n[7]=o=>t(s).name=o)},null,8,["value"])]),_:1},512)]),_:1})]),_:1}),e(y,null,{default:a(()=>[e(i,{span:24},{default:a(()=>[e(p,{label:"网格员",name:"userId",ref:"userId"},{default:a(()=>[e(H,{options:t(N),allowClear:"",value:t(s).userIds,"onUpdate:value":n[8]||(n[8]=o=>t(s).userIds=o),mode:"tags",placeholder:"选择网格员"},null,8,["options","value"])]),_:1},512)]),_:1}),e(i,{span:24},{default:a(()=>[e(p,{label:"排序",name:"userId",ref:"userId"},{default:a(()=>[e(g,{placeholder:"请输入排序",value:t(s).sort,"onUpdate:value":n[9]||(n[9]=o=>t(s).sort=o)},null,8,["value"])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["visible"])])}}});export{Oe as default};
