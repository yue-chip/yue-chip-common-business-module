import{A as W,a as m,m as z,C as de,S as ce,P as pe,I as me,b as fe,c as ve,d as _e,B as ge,_ as be,F as xe,W as Oe}from"./axios-85071db1.js";import{M as L,E as ke,_ as he,a as ye}from"./EditOutlined-007ce32e.js";import{h as e,i as Ce,j as p,k as Se,l as ze,w as t,u as o,m as U,o as $,p as C,c as R,b as q}from"./vue-router-ef9fc363.js";import{D as Ue,_ as we}from"./DeleteOutlined-ba572a4a.js";var Ae={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"}}]},name:"filter",theme:"outlined"};const Pe=Ae;function H(i){for(var u=1;u<arguments.length;u++){var r=arguments[u]!=null?Object(arguments[u]):{},s=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(r).filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable}))),s.forEach(function(d){Ne(i,d,r[d])})}return i}function Ne(i,u,r){return u in i?Object.defineProperty(i,u,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[u]=r,i}var j=function(u,r){var s=H({},u,r.attrs);return e(W,H({},s,{icon:Pe}),null)};j.displayName="FilterOutlined";j.inheritAttrs=!1;const Ie=j;var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"};const $e=Te;function K(i){for(var u=1;u<arguments.length;u++){var r=arguments[u]!=null?Object(arguments[u]):{},s=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(s=s.concat(Object.getOwnPropertySymbols(r).filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable}))),s.forEach(function(d){je(i,d,r[d])})}return i}function je(i,u,r){return u in i?Object.defineProperty(i,u,{value:r,enumerable:!0,configurable:!0,writable:!0}):i[u]=r,i}var F=function(u,r){var s=K({},u,r.attrs);return e(W,K({},s,{icon:$e}),null)};F.displayName="UserAddOutlined";F.inheritAttrs=!1;const Fe=F,Ge=Ce({__name:"index",setup(i){const u=p();let r=p(!1),s=p({pageSize:10,pageNumber:1}),d=p(!1),f=p(!1),c=p({}),N=p([]),b=p([]),O,k=p(!1),x=p([]),w=p([]);const Y={code:[{required:!0,message:"请输入编码",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}]},J=[{title:"名称",dataIndex:"name",fixed:"left",key:"name"},{title:"编码",dataIndex:"code",key:"code"},{title:"备注",dataIndex:"remark",key:"remark"},{title:"操作",key:"operation",fixed:"right",width:"300px"}];let M=p([]);const A=p({current:s.value.pageNumber?s.value.pageNumber:1,pageSize:s.value.pageSize?s.value.pageSize:30,onChange:(a,l)=>{s.value.pageSize=l,s.value.pageNumber=a,h()}});Se(()=>{h()});function h(){r.value=!0,m.axiosGet("/upms/console/role/list",{params:s.value},a=>{M.value=a.data,A.value.total=a.totalElements,A.value.current=a.pageNumber,A.value.pageSize=a.pageSize,r.value=!1},null,null)}function Q(){f.value=!0}function X(){f.value=!1,c.value={}}function Z(a){m.axiosGet("/upms/console/role/details",{params:{id:a}},l=>{l.status===200&&(c.value=l.data,c.value.state=l.data.state.name,f.value=!0)},null,null)}function ee(){u.value.validateFields().then(()=>{c.value.id?m.axiosPut("/upms/console/role/update",c.value,a=>{a.status===200&&(f.value=!1,c.value={},z.info(a.message),h())},null,null):m.axiosPost("/upms/console/role/add",c.value,a=>{a.status===200&&(f.value=!1,c.value={},z.info(a.message),h())},null,null)}).catch(a=>{})}function le(a){L.confirm({title:"是否要删除该数据?(错误的操作会带来灾难性的后果)",okText:"Yes",okType:"danger",cancelText:"No",onOk(){m.axiosDelete("/upms/console/role/delete",{params:{id:a}},l=>{l.status===200&&(z.info(l.message),h())},null,null)},onCancel(){}})}function te(a){d.value=!0,O=a,m.axiosGet("/upms/console/resources/tree",{params:{}},l=>{N.value=l.data},null,null),m.axiosGet("/upms/console/role/resources",{params:{roleId:a}},l=>{b.value=l.data},null,null)}function V(){b.value=[],d.value=!1,N.value=[],O=null}function ae(){m.axiosPost("/upms/console/role/resources",{roleId:O,resourcesIds:b.value},a=>{a.status===200&&(z.info(a.message),V())},null,null)}function ne(a){O=a,k.value=!0,m.axiosGet("/upms/console/user/list",{params:{pageNumber:1,pageSize:99999}},l=>{const _=l.data;w.value=[];for(const v in _)w.value.push({value:_[v].id,label:_[v].name})},null,null),m.axiosGet("/upms/console/role/user",{params:{roleId:a}},l=>{x.value=l.data},null,null)}function B(){O=null,k.value=!1,w.value=[],x.value=[]}function oe(a){m.axiosPost("/upms/console/user/role",{roleId:O,userIds:x.value},l=>{l.status===200&&(z.info(l.message),B())},null,null)}return(a,l)=>{const _=me,v=fe,g=ve,P=_e,y=ge,D=be,E=xe,G=de,se=he,ue=Oe,I=L,re=ye,ie=we;return $(),ze("div",null,[e(G,null,{default:t(()=>[e(E,{ref:"from",model:o(s),labelCol:{span:3,offset:0}},{default:t(()=>[e(P,{gutter:24},{default:t(()=>[e(g,{span:6},{default:t(()=>[e(v,{label:"名称",name:"name",ref:"name"},{default:t(()=>[e(_,{placeholder:"请输入名称",value:o(s).name,"onUpdate:value":l[0]||(l[0]=n=>o(s).name=n)},null,8,["value"])]),_:1},512)]),_:1}),e(g,{span:6},{default:t(()=>[e(v,{label:"编码",name:"code",ref:"code"},{default:t(()=>[e(_,{placeholder:"请输入编码",value:o(s).code,"onUpdate:value":l[1]||(l[1]=n=>o(s).code=n)},null,8,["value"])]),_:1},512)]),_:1}),e(g,{span:6}),e(g,{span:6})]),_:1}),e(P,{gutter:24,style:{height:"20px"}},{default:t(()=>[e(g,{span:24,style:{"text-align":"right"}},{default:t(()=>[e(v,null,{default:t(()=>[e(D,{size:5},{default:t(()=>[e(y,{type:"primary",onClick:l[2]||(l[2]=n=>{o(s).pageNumber=1,h()})},{icon:t(()=>[e(o(ce))]),default:t(()=>[C(" 查询 ")]),_:1}),e(y,{type:"primary",onClick:l[3]||(l[3]=n=>Q())},{icon:t(()=>[e(o(pe))]),default:t(()=>[C(" 添加 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(G,null,{default:t(()=>[e(se,{rowKey:"id",columns:J,"data-source":o(M),pagination:A.value,loading:o(r),scroll:{y:440}},{bodyCell:t(({column:n,text:Me,record:S})=>[n.key==="operation"?($(),R(D,{key:0,size:5},{default:t(()=>[e(y,{size:"small",onClick:T=>Z(S.id)},{icon:t(()=>[e(o(ke))]),default:t(()=>[C(" 修改 ")]),_:2},1032,["onClick"]),e(y,{size:"small",onClick:T=>te(S.id)},{icon:t(()=>[e(o(Ie))]),default:t(()=>[C(" 权限 ")]),_:2},1032,["onClick"]),e(y,{size:"small",onClick:T=>ne(S.id)},{icon:t(()=>[e(o(Fe))]),default:t(()=>[C(" 人员 ")]),_:2},1032,["onClick"]),S.isDefault===!1?($(),R(y,{key:0,size:"small",type:"dashed",onClick:T=>le(S.id)},{icon:t(()=>[e(o(Ue))]),default:t(()=>[C(" 删除 ")]),_:2},1032,["onClick"])):q("",!0)]),_:2},1024)):q("",!0)]),_:1},8,["data-source","pagination","loading"])]),_:1}),e(I,{width:"800px",visible:o(f),"onUpdate:visible":l[7]||(l[7]=n=>U(f)?f.value=n:f=n),title:"添加/修改角色",cancelText:"取消",okText:"保存",destroyOnClose:!0,mask:!0,maskClosable:!1,onCancel:X,onOk:ee},{default:t(()=>[e(E,{ref_key:"fromAddOrUpdate",ref:u,rules:Y,model:o(c),labelCol:{span:3,offset:0}},{default:t(()=>[e(P,null,{default:t(()=>[e(g,{span:12},{default:t(()=>[e(v,{label:"名称",name:"name",ref:"name"},{default:t(()=>[e(_,{placeholder:"请输入名称",value:o(c).name,"onUpdate:value":l[4]||(l[4]=n=>o(c).name=n)},null,8,["value"])]),_:1},512)]),_:1}),e(g,{span:12},{default:t(()=>[e(v,{label:"编码",name:"code",ref:"code"},{default:t(()=>[e(_,{placeholder:"请输入编码",value:o(c).code,"onUpdate:value":l[5]||(l[5]=n=>o(c).code=n)},null,8,["value"])]),_:1},512)]),_:1})]),_:1}),e(P,null,{default:t(()=>[e(g,{span:24},{default:t(()=>[e(v,{labelCol:{span:1.9,offset:0},label:"备注",name:"remark",ref:"remark"},{default:t(()=>[e(ue,{placeholder:"请输入备注","auto-size":{minRows:5,maxRows:5},value:o(c).remark,"onUpdate:value":l[6]||(l[6]=n=>o(c).remark=n)},null,8,["value"])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),e(I,{width:"400px",height:"600px",visible:o(d),"onUpdate:visible":l[9]||(l[9]=n=>U(d)?d.value=n:d=n),title:"权限",cancelText:"取消",okText:"保存",destroyOnClose:!0,mask:!0,maskClosable:!1,onCancel:V,onOk:ae},{default:t(()=>[e(re,{checkedKeys:o(b),"onUpdate:checkedKeys":l[8]||(l[8]=n=>U(b)?b.value=n:b=n),"default-expand-all":"",checkable:"",height:600,"tree-data":o(N)},null,8,["checkedKeys","tree-data"])]),_:1},8,["visible"]),e(I,{width:"400px",height:"600px",visible:o(k),"onUpdate:visible":l[11]||(l[11]=n=>U(k)?k.value=n:k=n),title:"人员",cancelText:"取消",okText:"保存",destroyOnClose:!0,mask:!0,maskClosable:!1,onCancel:B,onOk:oe},{default:t(()=>[e(ie,{value:o(x),"onUpdate:value":l[10]||(l[10]=n=>U(x)?x.value=n:x=n),mode:"tags",style:{width:"100%"},placeholder:"请选择人员",options:o(w)},null,8,["value","options"])]),_:1},8,["visible"])])}}});export{Ge as default};
